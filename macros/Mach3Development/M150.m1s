' M150_SafetyCheck.m1s' Safety check for tool movement compatibility' Uses #600 variable to identify current G-code mode' Uses #601, #602, #603 to identify movement direction (set by preprocessor)' Check if a program is actually running vs. just being loaded/displayedIf IsLoading() Then    Exit SubEnd If' Get current active tool data from DROstoolDirection = GetUserDRO(1802)  ' 1-4=Horizontal directions, 5=Vertical, 6=All directionsinSpindle = GetUserDRO(1808)  ' 1=yes, 0=no' Get G-code mode from user variable (set by preprocessor)gCodeMode = GetVar(600)  ' 0=G0, 1=G1, 2=G2, 3=G3' Get movement direction flags (set by preprocessor)moveX = GetVar(601)  ' 1 if X movement, 0 if notmoveY = GetVar(602)  ' 1 if Y movement, 0 if notmoveZ = GetVar(603)  ' 1 if Z movement, 0 if not' Display diagnostic informationMessage("SAFETY: Mode=" & gCodeMode & " Tool Dir=" & toolDirection)Sleep(100)Message("Movement: X=" & moveX & " Y=" & moveY & " Z=" & moveZ)Sleep(100)' Simple safety check for vertical drillsIf inSpindle = 1 And gCodeMode = 1 And toolDirection = 5 Then    ' Vertical drill in G1 mode - check for horizontal movement    If moveX = 1 Or moveY = 1 Then        Message("SAFETY ERROR: Vertical drill cannot make horizontal movements")        Sleep(100)        ' Stop program        Code("M00")    End IfEnd IfIf inSpindle = 1 Then    ' Tool is in spindle, continue    Select Case toolDirection        Case 1 ' Horizontal X+ direction            ' Handle horizontal X+ direction tool safety rules            If gCodeMode = 0 Then                ' G0 - free movement allowed            ElseIf gCodeMode = 1 Then                ' G1 = only X allowed                If (moveY = 1) Or (moveZ = 1) Then                    ' Stop - vertical movement not allowed                    ' Horizontal movement in Y not allowed                    Message("SAFETY ERROR: X+ drill cannot move in Y or Z during G1")                    Sleep(100)                    Code("M00")                End If            ElseIf gCodeMode = 2 Or gCodeMode = 3 Then                ' G2 or G3 - no movement allowed                ' Always stop                Message("SAFETY ERROR: X+ drill cannot perform circular movements")                Sleep(100)                Code("M00")            End If                    Case 2 ' Horizontal X- direction            ' Handle horizontal X- direction tool safety rules            If gCodeMode = 0 Then                ' G0 - free movement allowed            ElseIf gCodeMode = 1 Then                ' G1 = only X allowed                If (moveY = 1) Or (moveZ = 1) Then                    ' Stop - vertical movement not allowed                    ' Horizontal movement in Y not allowed                    Message("SAFETY ERROR: X- drill cannot move in Y or Z during G1")                    Sleep(100)                    Code("M00")                End If            ElseIf gCodeMode = 2 Or gCodeMode = 3 Then                ' G2 or G3 - no movement allowed                ' Always stop                Message("SAFETY ERROR: X- drill cannot perform circular movements")                Sleep(100)                Code("M00")            End If                    Case 3 ' Horizontal Y+ direction            ' Handle horizontal Y+ direction tool safety rules            If gCodeMode = 0 Then                ' G0 - free movement allowed            ElseIf gCodeMode = 1 Then                ' G1 = only Y allowed                If (moveX = 1) Or (moveZ = 1) Then                    ' Stop - vertical movement not allowed                    ' Horizontal movement in X not allowed                    Message("SAFETY ERROR: Y+ drill cannot move in X or Z during G1")                    Sleep(100)                    Code("M00")                End If            ElseIf gCodeMode = 2 Or gCodeMode = 3 Then                ' G2 or G3 - no movement allowed                ' Always stop                Message("SAFETY ERROR: Y+ drill cannot perform circular movements")                Sleep(100)                Code("M00")            End If                                Case 4 ' Horizontal Y- direction            ' Handle horizontal Y- direction tool safety rules            If gCodeMode = 0 Then                ' G0 - free movement allowed            ElseIf gCodeMode = 1 Then                ' G1 = only Y allowed                If (moveX = 1) Or (moveZ = 1) Then                    ' Stop - vertical movement not allowed                    ' Horizontal movement in X not allowed                    Message("SAFETY ERROR: Y- drill cannot move in X or Z during G1")                    Sleep(100)                    Code("M00")                End If            ElseIf gCodeMode = 2 Or gCodeMode = 3 Then                ' G2 or G3 - no movement allowed                ' Always stop                Message("SAFETY ERROR: Y- drill cannot perform circular movements")                Sleep(100)                Code("M00")            End If                    Case 5 ' Vertical drill            If gCodeMode = 0 Then                ' G0 - free movement allowed            ElseIf gCodeMode = 1 Then                ' G1 - only Z allowed                If (moveX = 1) Or (moveY = 1) Then                    ' Stop - horizontal move not allowed                    Message("SAFETY ERROR: Vertical drill cannot make horizontal movements")                    Sleep(100)                    Code("M00")                End If            ElseIf gCodeMode = 2 Or gCodeMode = 3 Then                ' G2 or G3 - no movement allowed                ' Always stop                Message("SAFETY ERROR: Vertical drill cannot perform circular movements")                Sleep(100)                Code("M00")            End If                    Case 6 ' Mill - no restrictions            ' All movements allowed for mills                    Case Else            ' Unknown tool - maybe stop?            Message("WARNING: Unknown tool direction " & toolDirection & ". Proceeding with caution.")            Sleep(100)    End SelectElse    ' Tool not in spindle    ' For now: stop program    Message("WARNING: No tool in spindle or tool data missing")    Sleep(100)End If   