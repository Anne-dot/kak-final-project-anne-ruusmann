# GCodeGenerator Package

This package generates G-code for drilling operations from processed data.

> **Note**: This document is up for further review and analysis to determine the final MVP scope.

## Purpose

The GCodeGenerator is responsible for:
- Creating machine-specific G-code from processed drilling data
- Handling tool selection and changes
- Generating drilling operations with appropriate parameters
- Formatting G-code for Mach3 compatibility
- Utilizing GCodeProcessor to add safety checks with safety variables and M150 calls

## Initial Module Structure

### `generator.py`
- Orchestrate the G-code generation process
- Apply machine-specific settings
- Handle overall program structure
- Integrate with GCodeProcessor for safety enhancements

### `drilling_operations.py`
- Generate G-code for different drilling operations
- Support different drilling directions
- Handle depth parameters and feed rates

### `tool_management.py`
- Select appropriate tools for operations
- Generate tool change commands
- Track tool usage and positions

### `machine_settings.py`
- Apply machine-specific G-code dialects
- Configure default parameters
- Handle machine-specific requirements

## Data Flow Example

Input from ProcessingEngine:
```python
{
    "workpiece": {
        "machine_width": 400.0,      # Width after processing
        "machine_height": 600.0,     # Height after processing
        "thickness": 18.0            # Material thickness
    },
    "drill_points": [
        {
            "machine_position": (85.3, 479.5, 0.0),
            "diameter": 8.0,
            "depth": 15.0,
            "extrusion_vector": (1.0, 0.0, 0.0)  # X+ direction
        }
        # More drilling points...
    ]
}
```

Basic G-code Generation:
```
G21 (Set units to mm)
G90 (Set absolute positioning)
G00Z50.000 (Move to safe height)
M03S1000 (Start spindle)

(8mm horizontal X+ drilling)
T1M06 (Load 8mm bit)
G00X85.300Y479.500Z5.000 (Rapid to position)
G01X100.300F100 (Drill 15mm in X+ direction)
G00X85.300 (Retract)

G00Z50.000 (Move to safe height)
M09 (Coolant off)
M30 (Program end)
```

Safety-Enhanced Output (after GCodeProcessor processing):
```
(Safety-enhanced G-code generated by preprocessor)
(Generated on: 2025-05-09 10:15:00)

G21 (Set units to mm)
G90 (Set absolute positioning)
G00Z50.000 (Move to safe height)
M03S1000 (Start spindle)

(8mm horizontal X+ drilling)
T1M06 (Load 8mm bit)
G00X85.300Y479.500Z5.000 (Rapid to position)
#600 = 1 (G1 mode)
#601 = 1 (X movement)
#602 = 0 (Y no movement)
#603 = 0 (Z no movement)
M150 (Safety check)
G01X100.300F100 (Drill 15mm in X+ direction)
G00X85.300 (Retract)

G00Z50.000 (Move to safe height)
M09 (Coolant off)
M30 (Program end)

(End of safety-enhanced G-code)
(Added 1 safety checks)
```

## MVP Focus

For the initial implementation, the focus will be on:
- Basic G-code generation for drilling operations
- Support for different drilling directions (vertical, horizontal)
- Simple tool selection and changes
- Safety enhancements through GCodeProcessor including:
  - Adding safety variables (#600-#603) before drilling movements
  - Adding M150 calls for safety macro execution
  - Proper movement type tracking (G00/G01)
  - Tracking axis movements (X,Y,Z)
- Proper commenting and formatting for Mach3

## Boundaries

This package:
- Generates G-code from scratch using ProcessingEngine data
- Uses GCodeProcessor to add safety enhancements to generated code
- Focuses on drilling operations specifically
- Targets Mach3 controller compatibility